---
version: "3"
services:
  adguard:
    image: adguard/adguardhome:latest
    hostname: adguard
    container_name: adguard
    #TIP: Just replace ${PORTBLOCK} with your servers VPN IP to set this up.
    ports:
      - ${PORTBLOCK}:446:443 #DNS over HTTPS, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:446:443/udp #DNS over HTTPS, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:853:853 #DNS over TLS, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:853:853/udp #DNS over TLS, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:8853:8853/udp #DNS over TLS, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:5443:5443 #DNSCrypt, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:5443:5443/udp #DNSCrypt, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:784:784/udp #DNS over QUIC, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:53:53 #DNS, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:53:53/udp #DNS, Do not expose this publicly on a remote server, only use VPN
      - ${PORTBLOCK}:67:67 #DHCP Server
      - ${PORTBLOCK}:68:68 #DHCP Server
      - ${PORTBLOCK}:68:68/udp #DHCP Server
    networks:
      - ${DOCKERNETWORK}
    environment:
      - "PGID=${ID}"
      - "PUID=${ID}"
      - "TZ=${TZ}"
    restart: ${RESTARTAPP}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${APPFOLDER}/adguard:/opt/adguardhome/work:rw
      - ${APPFOLDER}/adguard/conf:/opt/adguardhome/conf:rw
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "dockupdater.enable=true"
      - "traefik.http.routers.adguard-rtr.entrypoints=https"
      - "traefik.http.routers.adguard-rtr.rule=Host(`adguard.${DOMAIN}`)"
      - "traefik.http.routers.adguard-rtr.tls=true"
      - "traefik.http.routers.adguard-rtr.tls.certresolver=dns-cloudflare"
      - "traefik.http.routers.adguard-rtr.middlewares=chain-authelia@file"
      - "traefik.http.routers.adguard-rtr.service=adguard-svc"
      - "traefik.http.services.adguard-svc.loadbalancer.server.port=3000"
networks:
  proxy:
    driver: bridge
    external: true
