# This file is automatically generated

name: Clear Workflow Runs CI

on:
  workflow_dispatch:
  workflow_run:
    workflows: ["copycontainer"]
    types:
      - completed

jobs:
  clear-workflow-runs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4.1.3

      - name: Clear all workflow runs
        env:
          TOKEN: ${{ secrets.CRREMOVE }}
        run: |
          echo "${TOKEN}" | gh auth login --with-token
          runs=$(gh api repos/dockserver/container/actions/runs | jq -r .total_count)
          while true; do
          if [[ $(gh api repos/dockserver/dockserver/actions/runs | jq -r .total_count) -gt 2 ]]; then
             gh api repos/dockserver/dockserver/actions/runs \
              --paginate -q '.workflow_runs[] | "\(.id)"' | \
              xargs -n1 -I % gh api repos/dockserver/dockserver/actions/runs/% -X DELETE || true
          else
              exit 0
          fi
          done
